<div class="pl-2 pb-3">
  <h1>Saját órarendem</h1>
</div>

<div class="pl-2 pb-3">
  <span>
    Ezen az oldalon érheti el saját órarendjét. Lehetősége van új órát felvenni,
    létrehozott órájával kapcsolatos információkat frissíteni.
  </span>
</div>

<p-toolbar *ngIf="loggedInUser && loggedInUser?.role === 'EDZO'">
  <button
    pButton
    pRipple
    label="Új óra hozzáadása"
    icon="pi pi-plus"
    class="p-button-success mr-2"
    (click)="openNew()"
  ></button>
</p-toolbar>

<p-table
  [value]="displayableScheduleList | async"
  [tableStyle]="{ 'min-width': '50rem' }"
  styleClass="p-datatable-striped"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Hétfő</th>
      <th>Kedd</th>
      <th>Szerda</th>
      <th>Csütörtök</th>
      <th>Péntek</th>
      <th>Szombat</th>
      <th>Vasárnap</th>
    </tr>
  </ng-template>
  <ng-template
    pTemplate="body"
    let-schedule
    let-rowData
    let-editing="editing"
    let-ri="rowIndex"
  >
    <tr>
      <td
        [ngClass]="{
          'inactive-training': schedule.monday?.inactive,
          'training-full':
            schedule.monday &&
            schedule.monday?.attendanceCount === schedule.monday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.monday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.monday)">
          {{ schedule.monday?.startTime }} -
          {{ schedule.monday?.endTime }}
          <span *ngIf="schedule.monday"
            >({{ schedule.monday.type }}) [{{
              schedule.monday?.attendanceCount
            }}/{{ schedule.monday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.tuesday?.inactive,
          'training-full':
            schedule.tuesday &&
            schedule.tuesday?.attendanceCount === schedule.tuesday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.tuesday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.tuesday)">
          {{ schedule.tuesday?.startTime }} -
          {{ schedule.tuesday?.endTime }}
          <span *ngIf="schedule.tuesday"
            >({{ schedule.tuesday.type }}) [{{
              schedule.tuesday?.attendanceCount
            }}/{{ schedule.tuesday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.wednesday?.inactive,
          'training-full':
            schedule.wednesday &&
            schedule.wednesday?.attendanceCount ===
              schedule.wednesday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.wednesday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.wednesday)">
          {{ schedule.wednesday?.startTime }} -
          {{ schedule.wednesday?.endTime }}
          <span *ngIf="schedule.wednesday"
            >({{ schedule.wednesday.type }}) [{{
              schedule.wednesday?.attendanceCount
            }}/{{ schedule.wednesday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.thursday?.inactive,
          'training-full':
            schedule.thursday &&
            schedule.thursday?.attendanceCount ===
              schedule.thursday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.thursday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.thursday)">
          {{ schedule.thursday?.startTime }} -
          {{ schedule.thursday?.endTime }}
          <span *ngIf="schedule.thursday"
            >({{ schedule.thursday.type }}) [{{
              schedule.thursday?.attendanceCount
            }}/{{ schedule.thursday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.friday?.inactive,
          'training-full':
            schedule.friday &&
            schedule.friday?.attendanceCount === schedule.friday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.friday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.friday)">
          {{ schedule.friday?.startTime }} - {{ schedule.friday?.endTime }}
          <span *ngIf="schedule.friday"
            >({{ schedule.friday.type }}) [{{
              schedule.friday?.attendanceCount
            }}/{{ schedule.friday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.saturday?.inactive,
          'training-full':
            schedule.saturday &&
            schedule.saturday?.attendanceCount ===
              schedule.saturday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.saturday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.saturday)">
          {{ schedule.saturday?.startTime }} -
          {{ schedule.saturday?.endTime }}
          <span *ngIf="schedule.saturday"
            >({{ schedule.saturday.type }}) [{{
              schedule.saturday?.attendanceCount
            }}/{{ schedule.saturday?.capacity }}]</span
          >
        </a>
      </td>
      <td
        [ngClass]="{
          'inactive-training': schedule.sunday?.inactive,
          'training-full':
            schedule.sunday &&
            schedule.sunday?.attendanceCount === schedule.sunday?.capacity &&
            !loggedInUserTrainingIds.includes(schedule.sunday?.id)
        }"
      >
        <a (click)="editSchedule(schedule.sunday)">
          {{ schedule.sunday?.startTime }} - {{ schedule.sunday?.endTime }}
          <span *ngIf="schedule.sunday"
            >({{ schedule.sunday.type }}) [{{
              schedule.sunday?.attendanceCount
            }}/{{ schedule.sunday?.capacity }}]</span
          >
        </a>
      </td>
    </tr>
  </ng-template>
</p-table>

<form #newScheduleForm="ngForm">
  <p-dialog
    [(visible)]="newScheduleDialog"
    [style]="{ width: '450px' }"
    header="Új óra felvitele"
    [modal]="true"
    styleClass="p-fluid"
    [contentStyle]="{ overflow: 'visible' }"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="day">Nap</label>
        <p-dropdown
          [options]="dayList"
          [(ngModel)]="newSchedule.day"
          name="day"
          [required]="true"
          [autofocus]="true"
          optionLabel="name"
          optionValue="id"
        >
        </p-dropdown>
      </div>
      <div class="field">
        <label for="type">Óra típusa</label>
        <p-dropdown
          [options]="groupTrainingTypeList"
          [(ngModel)]="newSchedule.type"
          name="type"
          [required]="true"
        >
        </p-dropdown>
      </div>
      <div class="field">
        <label for="start">Óra kezdete</label>
        <p-calendar
          inputId="calendar-timeonly"
          [(ngModel)]="newSchedule.start"
          [timeOnly]="true"
          name="start"
          [required]="true"
        >
        </p-calendar>
      </div>
      <div class="field">
        <label for="end">Óra vége</label>
        <p-calendar
          inputId="calendar-timeonly"
          [(ngModel)]="newSchedule.end"
          [timeOnly]="true"
          name="end"
          [required]="true"
        >
        </p-calendar>
      </div>
      <div class="field">
        <label for="capacity">Kapacitás</label>
        <p-inputNumber
          name="capacity"
          required
          [max]="50"
          [min]="1"
          [(ngModel)]="newSchedule.capacity"
        ></p-inputNumber>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Vissza"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideNewDialog()"
      ></button>
      <button
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!newScheduleForm.valid"
        (click)="saveNewSchedule()"
      ></button>
    </ng-template>
  </p-dialog>
</form>

<form #editScheduleForm="ngForm">
  <p-dialog
    [(visible)]="editScheduleDialog"
    [style]="{ width: '450px' }"
    header="Óra módosítása"
    [modal]="true"
    styleClass="p-fluid"
    [contentStyle]="{ overflow: 'visible' }"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="day">Nap</label>
        <p-dropdown
          [options]="dayList"
          [(ngModel)]="editedSchedule.day"
          name="day"
          [required]="true"
          [autofocus]="true"
          optionLabel="name"
          optionValue="id"
        >
        </p-dropdown>
      </div>
      <div class="field">
        <label for="type">Óra típusa</label>
        <p-dropdown
          [options]="groupTrainingTypeList"
          [(ngModel)]="editedSchedule.type"
          name="type"
          [required]="true"
        >
        </p-dropdown>
      </div>
      <div class="field">
        <label for="start">Óra kezdete</label>
        <p-calendar
          inputId="calendar-timeonly"
          [(ngModel)]="editedSchedule.start"
          [timeOnly]="true"
          name="start"
          [required]="true"
        >
        </p-calendar>
      </div>
      <div class="field">
        <label for="end">Óra vége</label>
        <p-calendar
          inputId="calendar-timeonly"
          [(ngModel)]="editedSchedule.end"
          [timeOnly]="true"
          name="end"
          [required]="true"
        >
        </p-calendar>
      </div>
      <div class="field">
        <label for="capacity">Kapacitás</label>
        <p-inputNumber
          name="capacity"
          required
          [max]="50"
          [min]="1"
          [(ngModel)]="editedSchedule.capacity"
        ></p-inputNumber>
      </div>
      <div class="field">
        <p-checkbox
          name="inactive"
          [(ngModel)]="editedSchedule.inactive"
          [label]="'Inaktív'"
          [binary]="true"
        ></p-checkbox>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Vissza"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideEditedDialog()"
      ></button>
      <button
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!editScheduleForm.valid"
        (click)="saveEditedSchedule()"
      ></button>
      <button
        pButton
        pRipple
        label="Törlés"
        icon="pi pi-trash"
        class="p-button-text"
        (click)="deleteSchedule()"
      ></button>
    </ng-template>
  </p-dialog>
</form>
<p-toast></p-toast>
