<div class="pl-2 pb-3">
  <h1>Bérleteink</h1>
</div>

<div class="pl-2 pb-3">
  <span> Ezen az oldalon tekintheti meg elérhető bérleteinket! </span>
</div>

<div class="card">
  <form #form="ngForm">
    <p-toolbar
      styleClass="mb-4 gap-2"
      *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"
    >
      <button
        pButton
        pRipple
        label="Új bérlet hozzáadása"
        icon="pi pi-plus"
        class="p-button-success mr-2"
        (click)="openNew()"
      ></button>
    </p-toolbar>
    <p-table
      [value]="passList | async"
      [tableStyle]="{ 'min-width': '50rem' }"
      editMode="row"
      dataKey="id"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Megnevezés</th>
          <th>Ár (HUF)</th>
          <th>Napi belépési limit</th>
          <th>Heti belépési limit</th>
          <th>Szauna</th>
          <th>Kickbox</th>
          <th>Spinracing</th>
          <th>Pilates</th>
          <th>Yoga</th>
          <th></th>
          <th *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"></th>
        </tr>
      </ng-template>

      <ng-template
        pTemplate="body"
        let-pass
        let-editing="editing"
        let-ri="rowIndex"
      >
        <tr
          [pEditableRow]="pass"
          [ngClass]="{
            'owned-pass':
              loggedInUser &&
              loggedInUser?.role === 'TAG' &&
              currentPass &&
              pass.id === currentPass.id
          }"
        >
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  name="type"
                  [(ngModel)]="pass.type"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ pass.type }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-inputNumber
                  [(ngModel)]="pass.price"
                  mode="currency"
                  currency="HUF"
                  locale="hu-HU"
                  name="price"
                  inputId="integeronly"
                />
              </ng-template>
              <ng-template pTemplate="output">
                <span>
                  {{ pass.price | currency : ' ' : 'symbol' : '1.0' }}
                </span>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-inputNumber
                  [(ngModel)]="pass.dailyEntryCount"
                  name="dailyEntryCount"
                  [min]="0"
                  [max]="1"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{
                  pass.dailyEntryCount === 0
                    ? 'KORLÁTLAN'
                    : pass.dailyEntryCount
                }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-inputNumber
                  [(ngModel)]="pass.entryPerWeek"
                  name="entryPerWeek"
                  [min]="0"
                  [max]="7"
                />
              </ng-template>
              <ng-template pTemplate="output">
                <span>
                  {{ pass.entryPerWeek === 0 ? 'KORÁTLAN' : pass.entryPerWeek }}
                </span>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-checkbox
                  [(ngModel)]="pass.sauna"
                  name="sauna"
                  [binary]="true"
                ></p-checkbox>
              </ng-template>
              <ng-template pTemplate="output">
                <fa-icon [icon]="pass.sauna ? faCheck : faX"></fa-icon>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-checkbox
                  [(ngModel)]="pass.kickbox"
                  name="kickbox"
                  [binary]="true"
                ></p-checkbox>
              </ng-template>
              <ng-template pTemplate="output">
                <fa-icon [icon]="pass.kickbox ? faCheck : faX"></fa-icon>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-checkbox
                  [(ngModel)]="pass.spinracing"
                  name="spinracing"
                  [binary]="true"
                ></p-checkbox>
              </ng-template>
              <ng-template pTemplate="output">
                <fa-icon [icon]="pass.spinracing ? faCheck : faX"></fa-icon>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-checkbox
                  [(ngModel)]="pass.pilates"
                  name="pilates"
                  [binary]="true"
                ></p-checkbox>
              </ng-template>
              <ng-template pTemplate="output">
                <fa-icon [icon]="pass.pilates ? faCheck : faX"></fa-icon>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-checkbox
                  [(ngModel)]="pass.yoga"
                  name="yoga"
                  [binary]="true"
                ></p-checkbox>
              </ng-template>
              <ng-template pTemplate="output">
                <fa-icon [icon]="pass.yoga ? faCheck : faX"></fa-icon>
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <ng-container
              *ngIf="
                loggedInUser && loggedInUser?.role === 'TAG' && !currentPass
              "
            >
              <button pButton pRipple type="button" (click)="buyPass(pass)">
                Vásárlás
              </button>
            </ng-container>
            <ng-container *ngIf="currentPass && pass.id === currentPass.id">
              <button pButton pRipple type="button" (click)="deletePass()">
                Eltávolítás
              </button>
            </ng-container>
          </td>

          <td *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'">
            <div class="flex align-items-center justify-content-center gap-2">
              <button
                *ngIf="!editing"
                pButton
                pRipple
                type="button"
                pInitEditableRow
                icon="pi pi-pencil"
                (click)="onRowEditInit(pass)"
                class="p-button-rounded p-button-text"
                [disabled]="editing"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pSaveEditableRow
                icon="pi pi-check"
                (click)="onRowEditSave(pass)"
                class="p-button-rounded p-button-text p-button-success mr-2"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                icon="pi pi-times"
                (click)="onRowEditCancel(pass, ri)"
                class="p-button-rounded p-button-text p-button-danger"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </form>
</div>

<form #newPassForm="ngForm">
  <p-dialog
    [(visible)]="newPassDialog"
    [style]="{ width: '450px' }"
    header="Új bérlet felvitele"
    [modal]="true"
    styleClass="p-fluid"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="type">Megnevezés</label>
        <input
          type="text"
          pInputText
          name="type"
          [(ngModel)]="newPass.type"
          required
          autofocus
        />
      </div>
      <div class="field">
        <label for="price">Ár</label>
        <p-inputNumber
          [(ngModel)]="newPass.price"
          inputId="integeronly"
          suffix=" Ft"
          name="price"
          [min]="1"
        />
      </div>
      <div class="field">
        <label for="dailyEntryCount">Napi belépési limit</label>
        <p-inputNumber
          name="dailyEntryCount"
          [(ngModel)]="newPass.dailyEntryCount"
          required
          [min]="0"
          [max]="1"
        />
      </div>
      <div class="field">
        <label for="entryPerWeek">Heti belépési limit</label>
        <p-inputNumber
          name="entryPerWeek"
          [(ngModel)]="newPass.entryPerWeek"
          required
          [min]="0"
          [max]="7"
        />
      </div>
      <div class="field">
        <p-checkbox
          [(ngModel)]="newPass.sauna"
          name="sauna"
          label="Szauna"
          [binary]="true"
        />
      </div>
      <div class="field">
        <p-checkbox
          [(ngModel)]="newPass.kickbox"
          name="kickbox"
          label="Kickbox"
          [binary]="true"
        />
      </div>
      <div class="field">
        <p-checkbox
          [(ngModel)]="newPass.spinracing"
          name="spinracing"
          label="Spinracing"
          [binary]="true"
        />
      </div>
      <div class="field">
        <p-checkbox
          [(ngModel)]="newPass.pilates"
          name="pilates"
          label="Pilates"
          [binary]="true"
        />
      </div>
      <div class="field">
        <p-checkbox
          [(ngModel)]="newPass.yoga"
          name="yoga"
          label="Yoga"
          [binary]="true"
        />
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Bezárás"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideNewDialog()"
      ></button>
      <button
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!newPassForm.valid"
        (click)="saveNewPass()"
      ></button>
    </ng-template>
  </p-dialog>
</form>
<p-confirmDialog></p-confirmDialog>
