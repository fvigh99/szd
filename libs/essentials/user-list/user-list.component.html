<div class="pl-2 pb-3">
  <h1>Felhasználók</h1>
</div>

<div class="pl-2 pb-3">
  <span> Ezen az oldalon érhetőek el a regisztrált felhasználók adatai. </span>
</div>

<form #form="ngForm">
  <div class="card">
    <p-table
      [value]="userList | async"
      [tableStyle]="{ 'min-width': '50rem' }"
      styleClass="p-datatable-striped"
      [globalFilterFields]="[
        'username',
        'firstname',
        'lastname',
        'email',
        'role',
        'pass',
        'crd'
      ]"
      editMode="row"
      dataKey="id"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Felhasználónév</th>
          <th>Vezetéknév</th>
          <th>Keresztnév</th>
          <th>E-mail cím</th>
          <th>Szerepkör</th>
          <th>Bérlet</th>
          <th>Kép link</th>
          <th>Regisztráció dátuma</th>
        </tr>
        <tr>
          <th>
            <p-columnFilter type="text" field="username"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="firstname"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="lastname"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="email"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="status"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="pass"></p-columnFilter>
          </th>
          <th></th>
          <th>
            <p-columnFilter type="text" field="crd"></p-columnFilter>
          </th>
        </tr>
      </ng-template>
      <ng-template
        pTemplate="body"
        let-user
        let-editing="editing"
        let-ri="rowIndex"
      >
        <tr [pEditableRow]="user">
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  name="username"
                  [(ngModel)]="user.username"
                  [disabled]="true"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.username }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  name="firstname"
                  [(ngModel)]="user.firstname"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.firstname }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  name="lastname"
                  [(ngModel)]="user.lastname"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.lastname }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  name="email"
                  [(ngModel)]="user.email"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.email }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="roleList"
                  [(ngModel)]="user.role"
                  name="role"
                >
                </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.role }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-container *ngIf="user.role !== 'EDZO'">
                <ng-template pTemplate="input">
                  <p-autoComplete
                    [(ngModel)]="user.pass"
                    [suggestions]="filteredPasses"
                    (completeMethod)="filterPass($event)"
                    name="pass"
                    field="type"
                    [forceSelection]="true"
                  >
                  </p-autoComplete>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ user.pass?.type ?? 'Nincs' }}
                </ng-template>
              </ng-container>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <textarea
                  pTextArea
                  type="text"
                  name="picture"
                  [(ngModel)]="user.picture"
                  pInputTextarea
                  rows="3"
                  cols="20"
                ></textarea>
              </ng-template>
              <ng-template pTemplate="output">
                {{ user.picture ?? 'Nincs' }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            {{ user.crd | date : 'yyyy/MM/dd' }}
          </td>
          <td>
            <div class="flex align-items-center justify-content-center gap-2">
              <button
                *ngIf="!editing"
                pButton
                pRipple
                type="button"
                pInitEditableRow
                icon="pi pi-pencil"
                (click)="onRowEditInit(user)"
                class="p-button-rounded p-button-text"
                [disabled]="rowEditing"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pSaveEditableRow
                icon="pi pi-check"
                (click)="onRowEditSave(user)"
                class="p-button-rounded p-button-text p-button-success mr-2"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                icon="pi pi-times"
                (click)="onRowEditCancel(user, ri)"
                class="p-button-rounded p-button-text p-button-danger"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</form>
<p-toast></p-toast>
