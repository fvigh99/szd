<div class="pl-2 pb-3">
  <h1>Gépeink</h1>
</div>

<div class="pl-2 pb-3">
  <span>
    Ezen az oldalon érheti el a termünkben megtalálható gépeket. A képekre
    kattintva részletes információt kaphat róluk!
  </span>
</div>

<div>
  <p-toast></p-toast>
  <p-toolbar
    styleClass="mb-4 gap-2"
    *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"
  >
    <button
      pButton
      pRipple
      label="Új gép hozzáadása"
      icon="pi pi-plus"
      class="p-button-success mr-2"
      (click)="openNew()"
    ></button>
  </p-toolbar>
  <p-carousel
    [value]="machineList | async"
    [numVisible]="3"
    [numScroll]="1"
    [circular]="false"
  >
    <ng-template let-machine pTemplate="item">
      <div
        class="border-1 surface-border border-round m-2 text-center py-5 px-3"
      >
        <div class="mb-3">
          <a (click)="imageClicked(machine)">
            <img
              [src]="'assets/trainers/' + machine.picture"
              [alt]="machine.name"
              class="w-6 shadow-2"
            />
          </a>
        </div>
        <div>
          <h4 class="mb-1">{{ machine.name }}</h4>
        </div>
      </div>
    </ng-template>
  </p-carousel>
</div>
<form #newMachineForm="ngForm">
  <p-dialog
    [(visible)]="newMachineDialog"
    [style]="{ width: '450px' }"
    header="Új gép hozzáadása"
    [modal]="true"
    styleClass="p-fluid"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="name">Megnevezés</label>
        <input
          type="text"
          pInputText
          id="name"
          name="name"
          [(ngModel)]="newMachine.name"
          required
          autofocus
        />
      </div>
      <div class="field">
        <label for="summary">Leírás</label>
        <textarea
          id="summary"
          name="summary"
          [(ngModel)]="newMachine.summary"
          required
          pInputTextarea
          rows="3"
          cols="20"
        ></textarea>
      </div>
      <div class="field">
        <label for="type">Típus</label>
        <p-dropdown
          [options]="typeList"
          [(ngModel)]="newMachine.type"
          name="type"
          [required]="true"
        >
        </p-dropdown>
      </div>
      <div class="field">
        <label for="picture">Kép</label>
        <p-fileUpload
          *ngIf="!newMachine.picture"
          mode="basic"
          name="picture"
          accept="image/*"
          url="http://localhost:3000/image-upload/machine-picture"
          chooseIcon="pi pi-upload"
          chooseLabel="Tallózás"
          (onUpload)="uploadHandler($event, newMachine)"
          maxFileSize="100000000"
        >
        </p-fileUpload>
        <button
          *ngIf="newMachine.picture"
          class="btn btn-primary"
          pButton
          pRipple
          (click)="removePicture(newMachine)"
        >
          Kép törlése
        </button>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Bezárás"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideNewDialog()"
      ></button>
      <button
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!newMachineForm.valid"
        (click)="saveNewMachine()"
      ></button>
    </ng-template>
  </p-dialog>
</form>

<form #editMachineForm="ngForm">
  <p-dialog
    [(visible)]="editMachineDialog"
    [style]="{ width: '450px' }"
    [header]="
      loggedInUser && loggedInUser?.role === 'ADMIN'
        ? 'Gép módosítása'
        : 'Gép megtekintése'
    "
    [modal]="true"
    styleClass="p-fluid"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="name">Megnevezés</label>
        <input
          type="text"
          pInputText
          id="name"
          name="name"
          [(ngModel)]="editedMachine.name"
          required
          [autofocus]="loggedInUser && loggedInUser?.role === 'ADMIN'"
          [disabled]="!loggedInUser || loggedInUser?.role !== 'ADMIN'"
        />
      </div>
      <div class="field">
        <label for="summary">Leírás</label>
        <textarea
          id="summary"
          name="summary"
          pInputTextarea
          [(ngModel)]="editedMachine.summary"
          required
          rows="3"
          cols="20"
          [disabled]="!loggedInUser || loggedInUser?.role !== 'ADMIN'"
        ></textarea>
      </div>
      <div class="field">
        <label for="type">Típus</label>
        <p-dropdown
          *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"
          [options]="typeList"
          [(ngModel)]="editedMachine.type"
          name="type"
          [required]="true"
        >
        </p-dropdown>
        <input
          *ngIf="!loggedInUser || loggedInUser?.role !== 'ADMIN'"
          type="text"
          pInputText
          id="type"
          name="type"
          [(ngModel)]="editedMachine.type"
          required
          [disabled]="!loggedInUser || loggedInUser?.role !== 'ADMIN'"
        />
      </div>
      <ng-container *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'">
        <div class="field">
          <label for="picture">Kép</label>
          <p-fileUpload
            *ngIf="!editedMachine.picture"
            mode="basic"
            name="picture"
            accept="image/*"
            url="http://localhost:3000/image-upload/machine-picture"
            chooseIcon="pi pi-upload"
            chooseLabel="Tallózás"
            (onUpload)="uploadHandler($event, editedMachine)"
            maxFileSize="100000000"
          >
          </p-fileUpload>
          <button
            *ngIf="editedMachine.picture"
            class="btn btn-primary"
            pButton
            pRipple
            (click)="removePicture(editedMachine)"
          >
            Kép törlése
          </button>
        </div>
      </ng-container>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Bezárás"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideEditedDialog()"
      ></button>
      <button
        *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!editMachineForm.valid"
        (click)="saveEditedMachine()"
      ></button>
      <button
        *ngIf="loggedInUser && loggedInUser?.role === 'ADMIN'"
        pButton
        pRipple
        label="Törlés"
        icon="pi pi-trash"
        class="p-button-text"
        (click)="deleteMachine()"
      ></button>
    </ng-template>
  </p-dialog>
</form>
<p-confirmDialog></p-confirmDialog>
