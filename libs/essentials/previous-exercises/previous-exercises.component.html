<p-toast></p-toast>
<div class="card">
  <p-toolbar styleClass="mb-4 gap-2">
    <button
      pButton
      pRipple
      label="Új edzés hozzáadása"
      icon="pi pi-plus"
      class="p-button-success mr-2"
      (click)="openNew()"
    ></button>
  </p-toolbar>
  <p-table
    [value]="exerciseList | async"
    [tableStyle]="{ 'min-width': '50rem' }"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Időpont</th>
        <th>Gép</th>
        <th>Súly (kg)</th>
        <th>Ismétlés</th>
        <th>Intenzitás (1-10)</th>
        <th>Időtartam (perc)</th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-exercise
      let-editing="editing"
      let-ri="rowIndex"
    >
      <tr>
        <td>{{ exercise.date }}</td>

        <td>{{ exercise.machine?.name }}</td>

        <td>{{ exercise.weight }}</td>

        <td>{{ exercise.count }}</td>

        <td>{{ exercise.intensity }}</td>

        <td>{{ exercise.duration }}</td>

        <td>
          <button
            pButton
            pRipple
            class="p-button-text"
            (click)="deleteExercise(exercise)"
          >
            Törlés
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<form #newExerciseForm="ngForm">
  <p-dialog
    [(visible)]="newExerciseDialog"
    [style]="{ width: '450px' }"
    header="Új edzés hozzáadása"
    [modal]="true"
    styleClass="p-fluid"
  >
    <ng-template pTemplate="content">
      <div class="field">
        <label for="machine">Használt gép</label>
        <p-autoComplete
          [(ngModel)]="selectedMachine"
          [suggestions]="filteredMachines"
          (completeMethod)="filterMachine($event)"
          name="machine"
          field="name"
          [forceSelection]="true"
          [required]="true"
          (ngModelChange)="machineChanged()"
        >
        </p-autoComplete>
      </div>
      <div class="field">
        <label for="weight">Súly (kg)</label>
        <p-inputNumber
          type="text"
          id="weight"
          name="weight"
          [(ngModel)]="newExercise.weight"
          [disabled]="
            !selectedMachine?.type || selectedMachine?.type === 'Kardió'
          "
          [required]="
            selectedMachine?.type && selectedMachine?.type === 'Súlyzós'
          "
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="count">Ismétlés</label>
        <p-inputNumber
          type="text"
          id="count"
          name="count"
          [(ngModel)]="newExercise.count"
          [disabled]="
            !selectedMachine?.type || selectedMachine?.type === 'Kardió'
          "
          [required]="
            selectedMachine?.type && selectedMachine?.type === 'Súlyzós'
          "
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="intensity">Intenzitás (1-10)</label>
        <p-inputNumber
          id="intensity"
          name="intensity"
          [min]="1"
          [max]="10"
          [(ngModel)]="newExercise.intensity"
          [disabled]="
            !selectedMachine?.type || selectedMachine?.type === 'Súlyzós'
          "
          [required]="
            selectedMachine?.type && selectedMachine?.type === 'Kardió'
          "
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="duration">Időtartam (perc)</label>
        <p-inputNumber
          id="duration"
          name="duration"
          [(ngModel)]="newExercise.duration"
          [disabled]="
            !selectedMachine?.type || selectedMachine?.type === 'Súlyzós'
          "
          [required]="
            selectedMachine?.type && selectedMachine?.type === 'Kardió'
          "
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="date">Edzés időpontja</label>
        <p-calendar
          name="date"
          [(ngModel)]="newExercise.date"
          [showIcon]="true"
          [disabled]="!selectedMachine?.type"
          required
        ></p-calendar>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button
        pButton
        pRipple
        label="Vissza"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideNewDialog()"
      ></button>
      <button
        pButton
        pRipple
        label="Mentés"
        icon="pi pi-check"
        class="p-button-text"
        [disabled]="!newExerciseForm.valid"
        (click)="saveNewExercise()"
      ></button>
    </ng-template>
  </p-dialog>
</form>
<p-confirmDialog></p-confirmDialog>
